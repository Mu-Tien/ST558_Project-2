---
title: "ST558 Project 2"
author: "Mu-Tien, Lee"
output: 
  github_document:
      toc: true
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,warning = FALSE, error = FALSE, message=FALSE)
```

# Introduction
This project, I'm going to use the bike sharing data from [UCI machine Learning Repository] <https://archive.ics.uci.edu/ml/datasets/Bike+Sharing+Dataset>. The main purpose of the project is to build a model that can predict the count of rantal of bikes.
I am going to use the method.

# Require package
```{r require package, }
#install.packages("rpart")
library(MuMIn)
library(tidyverse)
library(caret)
library(corrplot)
library(readxl)
library(caret)
library(ggiraphExtra)
library(knitr)
library(ggplot2)
library(ggpubr)
library(rpart.plot)
```

# Read in data
```{r data}
setwd("C:\\Users\\LeeSF\\Desktop\\2020 fall\\ST558")

#read in hour data
HourData <- read.csv("hour.csv")
HourData<- HourData %>% select(-casual, -registered)
HourData$yr <- as.factor(HourData$yr)
HourData$holiday <- as.factor(HourData$holiday)
HourData$workingday <- as.factor(HourData$workingday)
#separate HourData by weekday
HourData <-HourData %>% filter(weekday==1)
HourData<- HourData %>% select(-weekday, -workingday)


#read in day data
DayData <- read.csv("day.csv")
DayData<- DayData %>% select(-casual, -registered)
DayData$yr <- as.factor(DayData$yr)
DayData$holiday <- as.factor(DayData$holiday)
DayData$workingday <- as.factor(DayData$workingday)
#separate DayData by weekday
DayData <-DayData %>% filter(weekday==1)
DayData<- DayData %>% select(-weekday, -workingday)

#Separate dataset into train and test data set
set.seed(1997)
train <- sample(1:nrow(HourData), size = nrow(HourData)*0.7)
test <- dplyr::setdiff(1:nrow(HourData), train)
HourDataTrain <- HourData[train, ]
HourDataTest <- HourData[test, ]


```

# Summary of training data
```{r summarizing data}
#prin out summary table for tempature humidity and windspeed
sum <- HourDataTrain%>% select(c(temp, atemp, hum, windspeed))
kable(apply(sum, 2,summary))

#plot the boxplot of tempature humidity and windspeed (not genralized amount)
#plot base
boxplot <- ggplot(data = HourDataTrain, aes(x=season))
#adding 4 variables
tem <-boxplot+geom_boxplot(aes(y=temp*41, group=season))+labs(y="Tempature (c)")
fetem <-boxplot+geom_boxplot(aes(y=atemp*50, group=season))+labs(y="Feeling Tempature (c)")
hum <-boxplot+geom_boxplot(aes(y=hum*100, group=season))+labs(y="Humidity")
wind <-boxplot+geom_boxplot(aes(y=windspeed*67, group=season))+labs(y="Wind Speed")
ggarrange(tem, fetem, hum , wind, ncol = 2, nrow = 2)

# plot the count distribution among time and weather
# by time
barplot1<-ggplot(data = HourDataTrain, aes(x=hr))+geom_col(aes(y=cnt, fill=yr))+facet_wrap(~mnth)
barplot1 <- barplot1+labs(x="time", y="Rental Count", title="Retal count distribution" )
barplot1+scale_fill_discrete(name="year", labels=c(2011,2012))

# by weather
barplot2 <-ggplot(data = HourDataTrain, aes(x=weathersit))+geom_col(aes(y=cnt, fill=yr))+facet_wrap(~mnth)
barplot2 <- barplot2+labs(x="season", y="Rental Count", title="Retal count distribution" )
barplot2+scale_fill_discrete(name="year", labels=c(2011,2012))
```

#Modeling
Here I use two different method, First one useing a tree-based models using leave one out cross validation. Second, I use the boosted tree model also with cross validation.

## Tree-based model
Since our response variables is continuous response, I choose to use Regression tree with leave one out cross validation (LOOCV) to pick up my final model.
```{r tree based model}
# set up training control, using repeated cross validation with 10 folder repeated 20 times.
set.seed(615)
trctrl <- trainControl(method = "LOOCV", number = 1)

#getModelInfo("rpart")
# training using regression tree models with default cp

model1 <- cnt~season+yr+mnth+hr+holiday+weathersit+temp+atemp+hum+windspeed

RegTree_fit1 <- train(model1, data = HourDataTrain, method = "rpart",
                 trControl=trctrl,
                 preProcess = c("center", "scale"),
                 tuneLength=40
                 )

# show the training result
RegTree_fit1
plot(RegTree_fit1)
rpart.plot(RegTree_fit1$finalModel)
```

## Boosted tree model
```{r boosted tree model}
# set up training control, using repeated cross validation with 10 folder
set.seed(615)
trctrl <- trainControl(method = "cv", number = 10)

#getModelInfo("rpart")
# training using regression tree models with default cp

model2 <- cnt~season+yr+mnth+hr+holiday+weathersit+temp+atemp+hum+windspeed

RegTree_fit2 <- train(model2, data = HourDataTrain, method = "bstTree",
                 trControl=trctrl,
                 preProcess = c("center", "scale"),
                 tuneGrid=expand.grid(mstop=c(100,200,300,500,1000,2000)
                                      ,maxdepth=2:6, nu=1)
                 )

# show the training result
RegTree_fit2
plot(RegTree_fit2)

```

